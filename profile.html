<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="nav.css">
	<link rel="stylesheet" type="text/css" href="profile.css">
	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyDeunaXdZRX8Kc960GDhzik2bpNKwN2lDY",
			authDomain: "mangosub-kaist.firebaseapp.com",
			databaseURL: "https://mangosub-kaist.firebaseio.com",
			projectId: "mangosub-kaist",
			storageBucket: "mangosub-kaist.appspot.com",
			messagingSenderId: "753510490577"
		};
		firebase.initializeApp(config);
		firebase.auth().onAuthStateChanged(function(user) {
			if (!user) {
				window.location = "index.html";
			}
		});
	</script>
</head>
<body style="background-color: #990000;">
	<ul class="nav">
		<li class="logo"><a href="index.html" style="padding: 0px;"><img src="./icons/logo_long.png"/></a></li>
		<li><a style="display: block; width: 77px;" id="bcredits"></a></li>
		<li><a href="" class="hov" onclick="firebase.auth().signOut();" style="cursor: pointer; display: block;">LOGOUT</a></li>
		<li><a href="profile.html" class="hov active">PROFILE</a></li>
		<li><a href="generate_info.html" class="hov">WORK</a></li>
		<li><a href="request.html" class="hov">REQUEST</a></li>
		<li><a href="index.html" class="hov">ABOUT</a></li>
	</ul>
	<div style="padding-top: 70px;">
		<div class="side" style="">
			<h1 style="text-align: center; padding-top: 30px; margin-bottom: 0px; font-size: 44px;" id="username"></h1>
			<p style="text-align: center; margin-top: 5px;" id="email"></p>
			<h1 style="text-align: center; margin-bottom: 0px; font-size: 44px;" id="ranking"></h1>
			<p style="text-align: center; margin-bottom: 0px; margin-top: 5px;">RANKING</p>
			<h1 style="text-align: center; margin-bottom: 0px; margin-top: 10px; font-size: 32px;" id="score"></h1>
			<p style="text-align: center; margin-bottom: 0px; margin-top: 5px;">TOTAL SCORE</p>

			<div style="width: 100%; padding-left: 20%; padding-right: 20%; margin-top: 10px">
				<div style="width: 20%; float: left;">
					<h1 style="text-align: center; margin-bottom: 0px; margin-top: 10px; font-size: 26px;" id="generate"></h1>
					<p style="text-align: center; margin-top: 5px; font-size: 16px;">GENERATE</p>
				</div>
				<div style="width: 20%; float: left;">
					<h1 style="text-align: center; margin-bottom: 0px; margin-top: 10px; font-size: 26px;" id="fix"></h1>
					<p style="text-align: center; margin-top: 5px; font-size: 16px;">FIX</p>
				</div>
				<div style="width: 20%; float: left;">
					<h1 style="text-align: center; margin-bottom: 0px; margin-top: 10px; font-size: 26px;" id="verify"></h1>
					<p style="text-align: center; margin-top: 5px; font-size: 16px;">VERIFY</p>
				</div>
			</div>
			
		</div>
		<div class="side" style="right: 0;">
			<p style="text-align: center; font-size: 32px; line-height: 16px; margin-bottom: 20px;">LEADERBOARD</p>
			<table class="leaderboard">
				<tr>
					<td>RANK</td>
					<td>USERNAME</td>
					<td>POINTS</td>
				</tr>
			</table>
			<div class="" style="background-color: #d3d3d3; height: calc(100% - 170px); overflow: auto; display: block; width: 100%;">
				<table class="leaderboard" id="rankings">
				</table>
			</div>
		</div>
		<div class="middle">
			<p style="text-align: center; color: white; font-size: 32px; line-height: 16px; margin-bottom: 29px;">HISTORY</p>
			<div class="" style=" height: calc(100% - 147px); overflow: auto; display: block; width: 100%;">
				
				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px; ">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">FIX#0301 for video 201711090420 has been approved by the VERIFY process. </td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px; color:blue;">+2 credits</td>
												<td style="width: 250px; color: green;">Accepted</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px; ">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">FIX#0301 for video 201711090420 has been awarded. </td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px; color:blue;">+5 credits</td>
												<td style="width: 250px; color: gray;">Waiting approval</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px;">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">VERIFY#02 for video 201711090012 has been awarded. </td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px; color:blue;">+3 credits</td>
												<td style="width: 250px; color: green;">Accepted</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px;">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">The subtitle for video "dying" requested at 2017-11-08-23:15 is ready for download.</td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px;">no change</td>
												<td style="width: 250px; color: blue;"><a href="">DOWNLOAD</a></td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px;">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">FIX#0102 for video 201711090420 has been rejected by the VERIFY process. </td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px;">no change</td>
												<td style="width: 250px; color: red;">Rejected</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px;">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">FIX#0102 for video 201711090420 has been awarded. </td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px; color: blue;">+5 credits</td>
												<td style="width: 250px; color: gray;">Waiting approval</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>

				<div class="event" style="">
					<table class="history">
						<tr>
							<td style="width: 150px; height: 118px;">ICON</td>
							<td style="vertical-align: top;">
								<table class="history" style="">
									<tr>
										<td style="width: 516px; height: 50px; padding-bottom: 10px; vertical-align: top; text-align: left;">You REQUESTed the subtitle for video "dying."</td>
									</tr>
									<tr>
										<table class="history">
											<tr style="height: 50px;">
												<td style="width: 250px;color: red;">-150 credits</td>
												<td style="width: 250px; color: gray;">Waiting results</td>
											</tr>
										</table>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>
			</div>
		</div>
		
	</div>
	<script>
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				// User is signed in.
				var displayName = user.displayName;
				var email = user.email;
				var uid = user.uid;

				document.getElementById("username").innerHTML = displayName;
				document.getElementById("email").innerHTML = email;

				var db = firebase.database().ref().child("users");

				db.child(uid).once("value").then(function(snapshot) {
					var value = snapshot.val();
					document.getElementById("bcredits").innerHTML = "â‚¡ " + String(value.credits);
					document.getElementById("score").innerHTML = String(value.score);
					document.getElementById("generate").innerHTML = String(value.generate);
					document.getElementById("fix").innerHTML = String(value.fix);
					document.getElementById("verify").innerHTML = String(value.verify);
					console.log(snapshot.events == null);
				});

				db.orderByChild("score").once("value").then(function(snapshot) {
					var names = new Array();
					var scores = new Array();
					var uids = new Array();
					snapshot.forEach(function(childSnapshot) {
						var value = childSnapshot.val();
						names.push(value.username);
						scores.push(value.score);
						uids.push(childSnapshot.key);
					});
					var rank = 1;
					while(names.length > 0) {
						var name = names.pop();
						var score = scores.pop();
						var uid2 = uids.pop();

						var row = document.createElement("tr");
						var drank = document.createElement("td");
						var trank = document.createTextNode(String(rank));
						drank.appendChild(trank);
						row.appendChild(drank);
						var dname = document.createElement("td");
						var tname = document.createTextNode(name);
						dname.appendChild(tname);
						row.appendChild(dname);
						var dscore = document.createElement("td");
						var tscore = document.createTextNode(String(score));
						dscore.appendChild(tscore);
						row.appendChild(dscore);
						document.getElementById("rankings").appendChild(row);

						if(uid == uid2) {
							document.getElementById("ranking").innerHTML = String(rank);
						}
						rank++;
					}
				});

			} else {
				// User is signed out.
				window.location = "index.html";
			}
		});
	</script>
</body>
</html>
