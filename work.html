<!DOCTYPE html>
<html>
<head>
	<title></title>
</head>
<body>

	<div>
		<h1>Finding best work that suits you...</h1>
	</div>
	<script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
	<script>
		// Initialize Firebase
		var config = {
			apiKey: "AIzaSyDeunaXdZRX8Kc960GDhzik2bpNKwN2lDY",
			authDomain: "mangosub-kaist.firebaseapp.com",
			databaseURL: "https://mangosub-kaist.firebaseio.com",
			projectId: "mangosub-kaist",
			storageBucket: "mangosub-kaist.appspot.com",
			messagingSenderId: "753510490577"
		};
		firebase.initializeApp(config);
		firebase.auth().onAuthStateChanged(function(user) {
			if (user) {
				// User is signed in.
				var displayName = user.displayName;
				var email = user.email;
				var uid = user.uid;

				var db = firebase.database().ref().child("users").child(uid);

				db.child("credits").once("value").then(function(snapshot) {
					var credits_val = snapshot.val();
					document.getElementById("bcredits").innerHTML = "â‚¡ " + String(credits_val);
				});

				var subDB = firebase.database().ref().child("subtitles");
				var f_flag = true;
			  	subDB.orderByChild("done").once("value").then(function(snapshot){
		  			snapshot.forEach(function(child){
				  		var doneValue = child.child("done").val();
						console.log(doneValue);
				  		if (doneValue === 0) {
				  			window.location = "generate_info.html";
							  	return true;
				  		}
				  		else if (doneValue === 1){
				  			window.location.href = "fix_info.html";
				  			return true;
				  		}
				  		else if (doneValue === 2){
				  			window.location.href = "verify_info.html";
				  			return true;
				  		}

				  		else {
				  			alert("FIX: No video left for creating subtitles. Check back later.");
				  			window.location.href = "index.html";
				  			return true;
				  		}
				  	});
				}); 
			}
			else {
				// User is signed out.
				window.location = "index.html";
			}
		});
	</script>
</body>
</html>
